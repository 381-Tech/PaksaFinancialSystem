# Script to rename node_modules to release file locks
Write-Host "=== Rename node_modules Script ===" -ForegroundColor Cyan

$nodeModulesPath = Join-Path $PSScriptRoot "node_modules"
$newName = "node_modules_old_$(Get-Date -Format 'yyyyMMdd_HHmmss')"
$newPath = Join-Path $PSScriptRoot $newName

if (Test-Path $nodeModulesPath) {
    Write-Host "Found node_modules directory at: $nodeModulesPath" -ForegroundColor Yellow
    
    try {
        # Try to rename the directory
        Rename-Item -Path $nodeModulesPath -NewName $newName -ErrorAction Stop
        Write-Host "Successfully renamed node_modules to $newName" -ForegroundColor Green
        Write-Host "You can now run 'npm install' to create a fresh node_modules directory." -ForegroundColor Green
        Write-Host "After verifying everything works, you can delete the old directory: $newPath" -ForegroundColor Yellow
    } catch {
        Write-Host "Failed to rename node_modules: $_" -ForegroundColor Red
        Write-Host "You may need to close any applications using these files and try again." -ForegroundColor Yellow
        Write-Host "Alternatively, you can try restarting your computer to release file locks." -ForegroundColor Yellow
    }
} else {
    Write-Host "node_modules directory not found at: $nodeModulesPath" -ForegroundColor Green
    Write-Host "No action needed." -ForegroundColor Green
}

Write-Host "=== Script Complete ===" -ForegroundColor Cyan
